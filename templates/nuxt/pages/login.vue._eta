<script setup lang="ts">
/**
 * This file was automatically generated by simpleapp generator.
 * --remove-this-line-to-prevent-override--
 * last change 2025-03-16
 * author: Ks Tan
 */
const { loggedIn, user, fetch: refreshSession } = useUserSession();
const credentials = reactive({
  uname: "",
  password: "",
});
async function login() {
  $fetch("/api/profile/login", {
    method: "POST",
    body: credentials,
  })
    .then(async () => {
      // Refresh the session on client-side and redirect to the home page
      await refreshSession();
      await reloadUserStore();
      await navigateTo("/");

    })
    .catch(() => alert("Bad credentials"));
}


function registerUser(){
  const createUserUrl = useRuntimeConfig().public.CREATE_USER_URL
  if(createUserUrl) {
    window.open(createUserUrl)
  }
  else {
    console.error('Undefine CREATE_USER_URL')
  }
}
</script>

<template>
  <form @submit.prevent="login">
    <div class="flex flex-row justify-center p-10">
      <div class="login-block shadow rounded p-10 gap-4 flex flex-col">
        <TextTitle class="flex flex-col">{{ t("login") }}</TextTitle>

        <div class="flex flex-col">
          <label>{{ t("user") }}</label>
          <InputText
            v-model="credentials.uname"
            type="text"
            placeholder="User Name"
          />
        </div>
        <div class="flex flex-col">
          <label>{{ t("password") }}</label>
          <InputText
            v-model="credentials.password"
            type="password"
            placeholder="Password"
          />
        </div>

        <Button type="submit">Login</Button>
        <ButtonText @click="registerUser">Register</ButtonText>
      </div>
    </div>
  </form>
</template>
<style scoped>
.login-block {
  box-shadow: 0px 4px 8.6px rgba(0, 178, 216, 0.25);
}
</style>
